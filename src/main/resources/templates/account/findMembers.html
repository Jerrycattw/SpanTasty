<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
<meta charset="UTF-8">
<title>æœå°‹å…¨éƒ¨æœƒå“¡</title>
</head>
<body>
	<div th:replace="~{display/navbar}"></div>

	<!-- ä¸»è¦å…§å®¹å€åŸŸ -->
<div class="content">
    <h1 class="display-6">ğŸ¥ª SpanTasty Restaurant Management System ğŸ¥</h1>
    <p>é¸æ“‡ä¸Šæ–¹åŠŸèƒ½ä»¥ç®¡ç†å„é …å…§å®¹</p>

    <!-- æœç´¢æ¡† -->
    <div>
        <input type="text" id="searchInput" placeholder="è¼¸å…¥æœƒå“¡åç¨±æˆ–å¸³è™Ÿé€²è¡Œæœå°‹">
        <button onclick="searchMembers()">æœå°‹</button>
    </div>

    <!-- é¡¯ç¤ºæœƒå“¡åˆ—è¡¨çš„è¡¨æ ¼ -->
    <table id="members-table" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>æœƒå“¡åç¨±</th>
                <th>å¸³è™Ÿ</th>
                <th>ç‹€æ…‹</th>
                <th>é ­åƒ</th>
            </tr>
        </thead>
        <tbody>
            <!-- æœƒå“¡è³‡æ–™å°‡ç”± JavaScript å‹•æ…‹åŠ è¼‰åˆ°é€™è£¡ -->
        </tbody>
    </table>

    <!-- åˆ†é æ§åˆ¶ -->
    <div id="pagination">
        <button id="prevPage">ä¸Šä¸€é </button>
        <button id="nextPage">ä¸‹ä¸€é </button>
    </div>
</div>

<script type="text/javascript">
    var currentPage = 0;
    var totalPages = 0;
    var selectedMemberId = null;
    var selectedStatus = null;
    var searchQuery = '';  // æ–°å¢ä¸€å€‹è®Šæ•¸ç”¨æ–¼ä¿å­˜æœç´¢æ¢ä»¶

    // ç‹€æ…‹å°æ‡‰çš„ä¸­æ–‡å€¼æ˜ å°„
    var statusMap = {
        'A': 'å•Ÿç”¨',
        'S': 'æš«åœ',
        'I': 'ç¦ç”¨'
    };

    // æœç´¢æœƒå“¡å‡½æ•¸
    function searchMembers() {
        searchQuery = document.getElementById('searchInput').value;  // ç²å–æœç´¢æ¢ä»¶
        loadMembers(0);  // å¾ç¬¬ä¸€é é–‹å§‹é¡¯ç¤ºæœç´¢çµæœ
    }

    // å‡½æ•¸ä¾†å‹•æ…‹åŠ è¼‰æœƒå“¡è³‡æ–™
    function loadMembers(page) {
        axios.get('/SpanTasty/admin/findMembers', {
            params: {
                page: page,
                size: 10,
                search: searchQuery  // å‚³éæœç´¢æ¢ä»¶åˆ°å¾Œç«¯
            }
        })
        .then(function (response) {
            document.querySelector('#members-table tbody').innerHTML = ''; // æ¸…ç©ºç•¶å‰çš„è¡¨æ ¼è³‡æ–™
            var members = response.data.data.members;

            members.forEach(function(member) {
                var avatarHtml = member.avatar 
                    ? '<img src="' + member.avatar + '" alt="Avatar" style="width:50px; height:50px;"/>'
                    : '<i class="fa-regular fa-user" style="font-size:50px;"></i>';

                var statusSelect = '<select onchange="handleStatusChange(this, ' + member.memberId + ')">';
                statusSelect += '<option value="A"' + (member.status === 'A' ? ' selected' : '') + '>å•Ÿç”¨</option>';
                statusSelect += '<option value="S"' + (member.status === 'S' ? ' selected' : '') + '>æš«åœ</option>';
                statusSelect += '<option value="I"' + (member.status === 'I' ? ' selected' : '') + '>ç¦ç”¨</option>';
                statusSelect += '</select>';

                var row = '<tr>' +
                    '<td>' + member.memberId + '</td>' +
                    '<td>' + member.memberName + '</td>' +
                    '<td>' + member.account + '</td>' +
                    '<td>' + statusSelect + '</td>' +
                    '<td>' + avatarHtml + '</td>' +
                    '</tr>';
                document.querySelector('#members-table tbody').innerHTML += row;
            });

            currentPage = response.data.data.currentPage;
            totalPages = response.data.data.totalPages;
            document.querySelector('#prevPage').disabled = currentPage === 0;
            document.querySelector('#nextPage').disabled = currentPage === totalPages - 1;
        })
        .catch(function (error) {
            console.log(error);
        });
    }

    // é»æ“Šä¸Šä¸€é æŒ‰éˆ•äº‹ä»¶
    document.querySelector('#prevPage').addEventListener('click', function() {
        if (currentPage > 0) {
            loadMembers(currentPage - 1);
        }
    });

    // é»æ“Šä¸‹ä¸€é æŒ‰éˆ•äº‹ä»¶
    document.querySelector('#nextPage').addEventListener('click', function() {
        if (currentPage < totalPages - 1) {
            loadMembers(currentPage + 1);
        }
    });

    // åˆæ¬¡åŠ è¼‰æ™‚èª¿ç”¨
    document.addEventListener('DOMContentLoaded', function() {
        loadMembers(0);
    });
</script>
</body>
</html>