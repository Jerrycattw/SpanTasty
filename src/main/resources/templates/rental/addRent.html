<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新增訂單</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
</head>

<body>
    <div th:replace="~{display/navbar}"></div>
    <div class="container" id="container">
        <h2>輸 入 租 借 訂 單 資 料</h2>
        <form th:action="@{/rent/add}" th:object="${rent}" method="post">
        <table class="table table-warning table-striped" id="table">
            <tr>
                <td>
                    租借押金:<input type="text" th:field="*{rentDeposit}" />
                </td>
            </tr>
            <tr>
                <td>
                    租借餐廳:
                    <select th:field="*{restaurantId}">
                        <option value="" selected disabled>請選擇租借餐廳</option>
                        <option th:each="restaurant : ${restaurants}" th:value="${restaurant.restaurantId}" th:text="${restaurant.restaurantName}"></option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    租借會員:
                    <select th:field="*{memberId}">
                        <option value="" selected disabled>請選擇會員編號</option>
						<option th:each="member : ${members}" th:value="${member.memberId}" th:text="${member.account}"></option>
                    </select>
                </td>
            </tr>
        </table>
        <div id="rentItemsContainer">
            <h2>輸 入 租 借 訂 單 細 項</h2>
            <div class="rent-item" th:each="rentItem, no : *{rentItems}">
                <table class="table table-warning table-striped">
                    <tr>
                        <td>
                            餐具編號:
                            <select th:field="*{rentItems[${no.index}].tablewareId}" onchange="updateDeposit(this)">
                                <option value="" selected disabled>請選擇餐具編號</option>
								<option th:each="tableware : ${tablewares}" th:value="${tableware.tablewareId}" th:data-deposit="${tableware.tablewareDeposit}" th:text="${tableware.tablewareName}"></option>
                            </select>
                        </td>
                        <td>
                            數量:<input type="number" th:field="*{rentItems[${no.index}].rentItemQuantity}"  min="1" />
                        </td>
                        <td>
                            押金:<input type="number" th:field="*{rentItems[${no.index}].rentItemDeposit}" name="rentItems[${no.index}].rentItemDeposit" />
                        </td>
                        <td>
                            <button type="button" onclick="removeRentItem(this)">移除</button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <button type="submit">新增訂單</button>
        </form>
        <button type="button" onclick="addRentItem()">新增訂單明細</button>
    </div>
    <script>
        let rentItemIndex = 1;

        function addRentItem() {
            const container = document.getElementById('rentItemsContainer');
            const newItem = document.createElement('div');
            newItem.classList.add('rent-item');
            newItem.innerHTML = `
        <table>
            <tr>
                <td>餐具編號:
                    <select name="rentItems[${rentItemIndex}].tablewareId" onchange="updateDeposit(this)">
	                    <option value="" selected disabled>請選擇餐具編號</option>
	                    <option th:each="tableware : ${tablewares}" value="${tableware.tablewareId}" data-deposit="${tableware.tablewareDeposit}" th:text="${tableware.tablewareName}"></option>
                    </select>
                </td>
                <td>數量:<input type="number" name="rentItems[${rentItemIndex}].rentItemQuantity" min="1" /></td>
                <td>押金:<input type="number" name="rentItems[${rentItemIndex}].rentItemDeposit" /></td>
                <td><button type="button" onclick="removeRentItem(this)">移除</button></td>
            </tr>
        </table>
    `;
            container.appendChild(newItem);
            rentItemIndex++;
        }

        // 删除订单明细
        function removeRentItem(button) {
            const rentItem = button.closest('.rent-item');
            rentItem.remove();
        }
    </script>
    <script>
    // 更新押金值
    function updateDeposit(selectElement) {
        // 獲取所選擇 option 的 data-deposit 屬性值
        const selectedOption = selectElement.selectedOptions[0];
        const depositValue = selectedOption.getAttribute('data-deposit');
        
        // 找到對應的押金輸入框
        const rentItemDiv = selectElement.closest('.rent-item');
        const depositInput = rentItemDiv.querySelector('input[name$=".rentItemDeposit"]');
        
        // 設置押金值
        if (depositValue) {
            depositInput.value = depositValue;
        }
    }
</script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script th:src="@{/js/axios.min.js}"></script>
</body>

</html>