<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>新增環保用具</title>
<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
<style>
.h {
	text-align: center;
}
form {
	width: 60%;
	margin: 0 auto;
	padding: 20px;
	border-radius: 10px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	background-color: #ffd966;
}
.stock-input{
	width: 86%;
	padding: 5px;
	margin-bottom: 0px;
	border: 1px solid #ccc;
	border-radius: 5px;
	box-sizing: border-box;
}
#btn-yellow{
		background-color: #f9e79f;
		border: 1px solid black;
	}
</style>
</head>
<body>
      <div th:replace="~{display/navbar}"></div>
    <div class="content" id="container">
        <h3 class="h">請選擇想搜尋餐廳或餐具（至少一個）</h3>
        <a th:href="@{/stock/getAll}" class="btn btn-sm mb-1" id="btn-yellow" >返回</a>
        <table>
            <tr><th>用具名稱: 
                    <select id="tablewareId" >
						<option value="" selected disabled>請選擇餐具編號</option>
						<option th:each="tableware : ${tablewares}" th:value="${tableware.tablewareId}" th:text="${tableware.tablewareName}"></option>
					</select>
            
            
                    餐廳名稱:
                    <select id="restaurantId" >
						<option value="" selected disabled>請選擇餐廳名稱</option>
						<option th:each="restaurant : ${restaurants}" th:value="${restaurant.restaurantId}" th:text="${restaurant.restaurantName}"></option>
					</select>
			<button id="send_btn" class="btn btn-primary btn-sm">確認</button>
			<button id="clear_btn" class="btn btn-secondary btn-sm">清空所有選項</button>
            </th></tr>
        </table>
        <table class="table table-warning table-striped" id="table"></table>
    </div>
    <script>
    	const url = 'http://localhost:8080/SpanTasty/stock/get';
    	const sendBtn = document.getElementById('send_btn');
    	const table = document.getElementById('table');
    	sendBtn.addEventListener('click', (e)=>{
	        const tablewareId = document.getElementById('tablewareId').value;
	        const restaurantId = document.getElementById('restaurantId').value;
	        
	        if (!tablewareId && !restaurantId) {
		        alert('請至少選擇一個條件進行查詢');
		        return;
		    }
	    	sendBtn.disabled = true;
	        
	        let dtoObject = {
			    tablewareId: tablewareId ? tablewareId : null,
			    restaurantId: restaurantId ? restaurantId : null
			};
	        axios.post(url,dtoObject)
	        .then(res => {
	            const stocks = res.data;
	            htmlMaker(stocks);
	        })
	        .catch(err => {
	            console.error(err); 
	        })
	        .finally(() => {
	            sendBtn.disabled = false; // 请求完成后重新启用按钮
	        });
    	})
    	
    	function updateData(event, tid, rid) {
		    //event.preventDefault(); // 阻止默认提交行为
		    const updateUrl = `http://localhost:8080/SpanTasty/stock/set/${tid}/${rid}`;
		    window.location.href = updateUrl;
		}
    	
    	function htmlMaker(stocks) {
        table.innerHTML = '';
        
        if (stocks.length === 0) {
	        table.innerHTML = '<h6>沒有找到相關結果</h6>';
	        return;
	    }
        const thead = document.createElement('thead');
        thead.innerHTML = 
        `
		<tr>
            <th>用具編號</th>
            <th>餐廳編號</th>
            <th>用具庫存</th>
            <th>庫存調整</th>
        </tr>
		`;
        table.appendChild(thead);
        
        const tbody = document.createElement('tbody');

        stocks.forEach(stock =>{
        	const tr = document.createElement('tr');
            tr.innerHTML = 
            `
			<td>${stock.tablewareId}</td>
			<td>${stock.restaurantId}</td>
			<td>${stock.stock}</td>
			<td class="align-middle">
			    <button onclick="updateData(event,${stock.tablewareId},${stock.restaurantId})" class="btn bg-success text-white btn-sm">盤盈虧</button>
			</td>
            `;
            tbody.appendChild(tr);
        });
        table.appendChild(tbody);
    }
    
    const clearBtn = document.getElementById('clear_btn');

	clearBtn.addEventListener('click', (e) => {
	    // 清空所有輸入框和選項
	    document.getElementById('tablewareId').value = '';
	    document.getElementById('restaurantId').value = '';
	});
    </script>
    <script>
		document.addEventListener("DOMContentLoaded", function() {
			showSidebar('rental');
		});
	</script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script th:src="@{/js/axios.min.js}"></script> 
</body>

</html>